<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chef Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <h2>Chef Dashboard</h2>
  <nav>
    <a href="home.html">Home</a> |
    <span id="user-info" style="margin-left: 15px; color: #555;"></span> |
    <a href="#" onclick="logout()">Logout</a>
  </nav>
</header>

<section id="orders-container">
  <p>Loading your assigned orders...</p>
</section>

<script>
  const user = JSON.parse(localStorage.getItem("user"));

  if (!user || user.role !== "CHEF") {
    alert("Only chefs can access this page.");
    window.location.href = "login.html";
  }
document.getElementById("user-info").textContent = `Logged in as: ${user.username}`;
  async function logout() {
    sessionStorage.clear();
    window.location.href = "login.html";
  }

  async function loadAssignedOrders() {
    const response = await fetch(`/api/orders/chef/${user.id}`);
    const orders = await response.json();

    const container = document.getElementById("orders-container");
    container.innerHTML = "";

    if (orders.length === 0) {
      container.innerHTML = "<p>No orders assigned to you currently.</p>";
      return;
    }

    orders.forEach(order => {
      const card = document.createElement("div");
      card.className = "order-card";

      card.innerHTML = `
        <h3>Order #${order.id}</h3>
        <p><strong>Status:</strong> <span>${order.status}</span></p>
        <p><strong>Created:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
        <p><strong>Updated:</strong> ${new Date(order.updatedAt).toLocaleString()}</p>
        <div><strong>Items:</strong></div>
        <ul>
          ${(order.items || []).map(item => `
            <li>${item.name} x ${item.quantity} ${item.specialNotes ? `(Note: ${item.specialNotes})` : ""}</li>
          `).join("")}
        </ul>
        <label for="statusSelect-${order.id}">Update Status:</label>
        <select id="statusSelect-${order.id}">
          <option value="PENDING" ${order.status === "PENDING" ? "selected" : ""}>Pending</option>
          <option value="IN_PROGRESS" ${order.status === "IN_PROGRESS" ? "selected" : ""}>In Progress</option>
          <option value="READY" ${order.status === "READY" ? "selected" : ""}>Ready</option>
          <option value="COMPLETED" ${order.status === "COMPLETED" ? "selected" : ""}>Completed</option>
          <option value="CANCELLED" ${order.status === "CANCELLED" ? "selected" : ""}>Cancelled</option>
        </select>
        <button onclick="updateStatus(${order.id})">Update</button>
      `;

      container.appendChild(card);
    });
  }

  async function updateStatus(orderId) {
    const select = document.getElementById(`statusSelect-${orderId}`);
    const newStatus = select.value;

    const response = await fetch(`/api/orders/${orderId}/status`, {
      method: "PUT",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `status=${encodeURIComponent(newStatus)}`
    });

    if (response.ok) {
      alert("Order status updated.");
      loadAssignedOrders();
    } else {
      const error = await response.text();
      alert("Failed to update status: " + error);
    }
  }

  loadAssignedOrders();
</script>

<style>
  .order-card {
    background: #fff;
    margin: 20px auto;
    padding: 20px;
    border-radius: 8px;
    max-width: 600px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  ul {
    margin-top: 10px;
    padding-left: 20px;
  }
  label, select, button {
    display: block;
    margin-top: 10px;
  }
  button {
    padding: 8px 12px;
    margin-top: 10px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover {
    background-color: #218838;
  }
</style>

</body>
</html>
