<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <script src="bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="bootstrap.min.css">
</head>
<body>

<div class="sidebar">
    <h4>Hotel System</h4>
    <div id="role-menu"></div>
    <hr>
    <a href="#">Logged in as: <span id="usernameLabel"></span></a>
    <a href="#" onclick="logout()">Logout</a>
</div>

<div class="main-content">
    <h2>Welcome to the Hotel Management System</h2>
    <p id="userInfo"></p>
    <p class="mt-3">Use the navigation menu on the left to access your tools.</p>

    <div class="modal fade" id="salesReportModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sales Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="salesReportContent">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const user = JSON.parse(localStorage.getItem("user"));
if (!user) {
    window.location.href = "login.html";
} else {
    document.getElementById("usernameLabel").innerText = user.username;
    buildRoleSidebar();
}

function logout() {
    localStorage.clear();
    window.location.href = "login.html";
}

function buildRoleSidebar() {
    const container = document.getElementById("role-menu");
    let links = "";

    if (user.role === "CUSTOMER") {
        links += `<a href="browse-menu.html">Browse Menu</a>`;
        links += `<a href="orders.html">My Orders</a>`;
    }
    else if (user.role === "MANAGER") {
        links += `<a href="assign-chef.html">Assign Chef</a>`;
        links += `<a href="#" id="salesReportLink">View Sales Report</a>`;
        links += `<a href="analytics.html">Real-Time Analytics</a>`;
    }
    else if (user.role === "CHEF") {
        links += `<a href="chef-dashboard.html">Chef Dashboard</a>`;
    }

    container.innerHTML = links;

    if (user.role === "MANAGER") {
        const reportLink = document.getElementById("salesReportLink");
        if (reportLink) {
            reportLink.addEventListener("click", (e) => {
                e.preventDefault();
                showSalesReport();
            });
        }
    }
}

async function showSalesReport() {
    try {
        const response = await fetch(`/api/orders/report/sales`);
        if (!response.ok) throw new Error("Failed to fetch report.");

        const report = await response.json();

        let html = `
            <p><strong>Total Orders:</strong> ${report.totalOrders}</p>
            <h6>Item Breakdown:</h6>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Quantity Sold</th>
                        <th>Total Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${report.items.map(item => `
                        <tr>
                            <td>${item.itemName}</td>
                            <td>${item.quantitySold}</td>
                            <td>$${item.totalAmount.toFixed(2)}</td>
                        </tr>
                    `).join("")}
                </tbody>
            </table>
        `;

        document.getElementById("salesReportContent").innerHTML = html;
        new bootstrap.Modal(document.getElementById('salesReportModal')).show();

    } catch (err) {
        alert("Error fetching sales report: " + err.message);
    }
}

</script>
</body>
</html>
